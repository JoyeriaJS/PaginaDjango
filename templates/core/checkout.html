{% extends "base_site.html" %}
{% block title %}Checkout — Artesanías Pachy{% endblock %}

{% block content %}
<div class="container py-5">

  <h1 class="h4 fw-bold mb-4">Finalizar compra</h1>

  {% if not cart.items %}
    <div class="text-center py-5">
      <h2 class="h5 fw-bold">Tu carrito está vacío</h2>
      <p class="text-muted">Agrega productos antes de continuar.</p>
      <a href="/" class="btn btn-primary rounded-pill px-4">Volver al catálogo</a>
    </div>
  {% else %}

  <div class="row g-5">

    <!-- ========================================================= -->
    <!-- FORMULARIO IZQUIERDA -->
    <!-- ========================================================= -->
    <div class="col-lg-7">

      <form method="post" action="{% url 'core:checkout' %}">
        {% csrf_token %}

        <!-- DATOS DEL CLIENTE -->
        <div class="mb-4">
          <h2 class="h5 fw-bold mb-3">Información del cliente</h2>

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre completo</label>
              <input type="text" name="full_name" class="form-control"
                     required placeholder="Juan Pérez">
            </div>

            <div class="col-md-6">
              <label class="form-label">Correo electrónico</label>
              <input type="email" name="email" class="form-control"
                     required placeholder="nombre@correo.com">
            </div>

            <div class="col-md-6">
              <label class="form-label">Teléfono</label>
              <input type="text" name="phone" class="form-control"
                     required placeholder="+56 9 1234 5678">
            </div>
          </div>
        </div>


        <!-- DIRECCIÓN (Opcional, pero recomendado) -->
        <div class="mb-4">
          <h2 class="h5 fw-bold mb-3">Dirección de envío</h2>

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Comuna</label>
              <input type="text" name="city" class="form-control"
                     required placeholder="Santiago">
            </div>

            <div class="col-md-6">
              <label class="form-label">Dirección</label>
              <input type="text" name="address" class="form-control"
                     required placeholder="Av. Central 123">
            </div>

            <div class="col-md-6">
              <label class="form-label">Código Postal (opcional)</label>
              <input type="text" name="zipcode" class="form-control"
                     placeholder="0000000">
            </div>
          </div>
        </div>

        <!-- NOTA OPCIONAL -->
        <div class="mb-4">
          <label class="form-label fw-semibold">Comentario del pedido (opcional)</label>
          <textarea name="note" class="form-control" rows="3"
                    placeholder="Indicaciones, referencias, color especial, etc."></textarea>
        </div>


        <!-- BOTÓN (solo completa datos, no paga aún) -->
        <button class="btn btn-outline-primary btn-lg rounded-pill px-4 w-100 mt-3">
          Continuar a pago
        </button>

      </form>

    </div>




    <!-- ========================================================= -->
    <!-- RESUMEN DE PEDIDO -->
    <!-- ========================================================= -->
    <div class="col-lg-5">

      <div class="card shadow-sm border-0 p-4">

        <h5 class="fw-bold mb-3">Resumen del pedido</h5>

        <ul class="list-group list-group-flush mb-3">

          {% for line in cart.items %}
          <li class="list-group-item d-flex justify-content-between align-items-center px-0">
            <div>
              <div class="fw-semibold">{{ line.product.name }}</div>
              <div class="small text-muted">x{{ line.qty }}</div>
            </div>
            <div class="fw-semibold">${{ line.line_total }}</div>
          </li>
          {% endfor %}

        </ul>

        <div class="d-flex justify-content-between small text-muted mb-1">
          <span>Subtotal</span>
          <span>${{ cart.subtotal }}</span>
        </div>

        <div class="d-flex justify-content-between small text-muted mb-1">
          <span>Envío</span>
          <span>Por confirmar</span>
        </div>

        <div class="d-flex justify-content-between fw-bold h5 mt-3 mb-4">
          <span>Total</span>
          <span>${{ cart.grand_total }}</span>
        </div>



        <!-- ========================================================= -->
        <!-- BOTÓN MERCADO PAGO (OFICIAL) -->
        <!-- ========================================================= -->
        <div class="mt-3">
          <h6 class="fw-semibold mb-2">Pagar con Mercado Pago</h6>

          <!-- Aquí se insertará el BOTÓN OFICIAL de Mercado Pago -->
          <div id="mp-button-placeholder" class="mt-3">
            <!-- Lo llenaremos cuando integremos Mercado Pago -->
            <button class="btn btn-primary btn-lg w-100 rounded-pill" disabled>
              Cargando botón de pago…
            </button>
          </div>
        </div>

      </div>

    </div>

  </div>

  {% endif %}

</div>
{% endblock %}
