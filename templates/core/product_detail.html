{% extends "base_site.html" %}
{% block title %}{{ product.name }} — Artesanías Pachy{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="row g-5">

    <!-- ========================================================= -->
    <!-- GALERÍA IZQUIERDA (IMAGEN PRINCIPAL + MINIATURAS) -->
    <!-- ========================================================= -->
    <div class="col-lg-6">

      <!-- Imagen principal -->
      <div id="pd-main"
           class="gallery-elev rounded-4 overflow-hidden mb-3"
           data-zoom="{{ product.images.first.image.url }}">
        {% with img=product.images.first %}
        {% if img %}
          <img src="{{ img.image.url }}"
               alt="{{ img.alt|default:product.name }}"
               class="w-100"
               style="max-height:520px;object-fit:cover;cursor:zoom-in;">
        {% else %}
          <div class="ratio ratio-1x1 bg-light d-flex justify-content-center align-items-center text-muted">
            Sin imagen
          </div>
        {% endif %}
        {% endwith %}
      </div>

      <!-- Mini-galería -->
      <div class="d-flex gap-2 flex-wrap">
        {% for img in product.images.all %}
        <button class="thumb-64 border-0 p-0"
                data-src="{{ img.image.url }}"
                data-target="#pd-main">
          <img src="{{ img.image.url }}" class="w-100 h-100" style="object-fit:cover;border-radius:.6rem;">
        </button>
        {% endfor %}
      </div>

    </div>




    <!-- ========================================================= -->
    <!-- INFORMACIÓN DEL PRODUCTO -->
    <!-- ========================================================= -->
    <div class="col-lg-6">

      <h1 class="h3 fw-bold">{{ product.name }}</h1>

      <div class="text-muted mb-2">
        {{ product.category.name }}
      </div>

      <div class="d-flex align-items-center gap-3 mb-4">
        <div class="price h4 m-0 fw-bold text-dark">
          ${{ product.price }}
        </div>

        {% if product.old_price and product.old_price > product.price %}
          <div class="price small">
            <span class="old">${{ product.old_price }}</span>
            <span class="badge bg-danger">Oferta</span>
          </div>
        {% endif %}
      </div>



      <!-- Descripción -->
      {% if product.description %}
      <p class="text-muted mb-4" style="white-space:pre-line;">
        {{ product.description }}
      </p>
      {% endif %}



      <!-- ========================================================= -->
      <!-- FORMULARIO: Añadir al carrito -->
      <!-- ========================================================= -->
      <form method="post"
            action="{% url 'core:add_to_cart' product.pk %}"
            class="mt-3 border-top pt-4">
        {% csrf_token %}

        <div class="mb-3">
          <label class="form-label fw-semibold">Cantidad</label>
          <input type="number" name="qty" value="1" min="1"
                 class="form-control"
                 style="max-width:120px;">
        </div>

        <button class="btn btn-primary btn-lg w-100 rounded-pill">
          Añadir al carrito
        </button>
      </form>




      <!-- ========================================================= -->
      <!-- DETALLES ESPECIALES (BlueCast style) -->
      <!-- ========================================================= -->
      <div class="mt-5">
        <h4 class="h6 fw-bold mb-3">Detalles</h4>
        <ul class="list-unstyled text-muted small">
          <li>✔ Producto artesanal</li>
          <li>✔ Material certificado</li>
          <li>✔ Elaborado en Chile</li>
          <li>✔ Compra segura</li>
        </ul>
      </div>

    </div>

  </div>



  <!-- ========================================================= -->
  <!-- PRODUCTOS RELACIONADOS -->
  <!-- ========================================================= -->
  {% if related_products %}
  <section class="mt-5 pt-5">

    <div class="d-flex justify-content-between align-items-end mb-4">
      <h2 class="h5 fw-bold m-0">Productos relacionados</h2>
    </div>

    <div class="row g-4">
      {% for p in related_products %}
      <div class="col-6 col-md-3" data-aos="fade-up">

        <a class="card h-100 product-card card-elev text-decoration-none border-0 shadow-sm"
           href="{% url 'core:product_detail' p.pk %}">
          
          {% with img=p.images.first %}
          {% if img %}
            <img src="{{ img.image.url }}" loading="lazy" class="card-img-top rounded-top" alt="{{ p.name }}">
          {% else %}
            <div class="ratio ratio-1x1 bg-light d-flex justify-content-center align-items-center text-muted">
              Sin imagen
            </div>
          {% endif %}
          {% endwith %}

          <div class="card-body">
            <h3 class="h6 fw-semibold text-dark mb-1">{{ p.name }}</h3>
            <div class="small text-muted mb-1">{{ p.category.name }}</div>
            <div class="fw-bold text-dark">${{ p.price }}</div>
          </div>

        </a>

      </div>
      {% endfor %}
    </div>

  </section>
  {% endif %}



</div>




<!-- ========================================================= -->
<!-- MODAL ZOOM DE IMÁGENES -->
<!-- ========================================================= -->
<div class="modal fade" id="imgZoomModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark border-0">
      <img id="imgZoomTarget" class="w-100 rounded-3">
    </div>
  </div>
</div>

{% endblock %}
