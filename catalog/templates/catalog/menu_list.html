{% extends "catalog/base_admin.html" %}
{% block title %}Menú superior{% endblock %}

{% block content %}

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="fw-bold m-0" style="font-size:1.7rem;">Menú superior</h1>

    <a href="{% url 'catalog:menu_create' %}"
       class="btn btn-primary px-4 py-2"
       style="border-radius:12px;">
        + Nuevo elemento
    </a>
</div>

<!-- TABLE -->
<div class="card shadow-sm border-0 p-3" style="border-radius:16px;">
    <div class="table-responsive">

        <table class="table align-middle">

            <thead class="table-light" style="border-bottom:2px solid #e5e5e5;">
                <tr>
                    <th>Título</th>
                    <th>URL</th>
                    <th>Orden</th>
                    <th>Visible</th>
                    <th>Staff</th>
                    <th class="text-end">Acciones</th>
                </tr>
            </thead>

            <tbody>

            {% for m in roots %}
                <!-- NODO PADRE -->
                <tr class="table-secondary">
                    <td class="fw-bold">{{ m.title }}</td>
                    <td>{{ m.url }}</td>
                    <td>{{ m.order }}</td>
                    <td>{{ m.is_active|yesno:"Sí,No" }}</td>
                    <td>{{ m.staff_only|yesno:"Sí,No" }}</td>

                    <td class="text-end">
                        <a class="btn btn-sm btn-outline-primary me-1"
                           style="border-radius:10px;"
                           href="{% url 'catalog:menu_edit' m.pk %}">
                            Editar
                        </a>

                        <form method="post"
                              action="{% url 'catalog:menu_delete' m.pk %}"
                              class="d-inline">
                            {% csrf_token %}
                            <button class="btn btn-sm btn-outline-danger"
                                    style="border-radius:10px;"
                                    onclick="return confirm('¿Eliminar {{ m.title|escapejs }}?')">
                                Eliminar
                            </button>
                        </form>
                    </td>
                </tr>

                <!-- NODOS HIJOS -->
                {% for c in m.children.all %}
                <tr>
                    <td>— {{ c.title }}</td>
                    <td>{{ c.url }}</td>
                    <td>{{ c.order }}</td>
                    <td>{{ c.is_active|yesno:"Sí,No" }}</td>
                    <td>{{ c.staff_only|yesno:"Sí,No" }}</td>

                    <td class="text-end">
                        <a class="btn btn-sm btn-outline-primary me-1"
                           style="border-radius:10px;"
                           href="{% url 'catalog:menu_edit' c.pk %}">
                           Editar
                        </a>

                        <form method="post"
                              action="{% url 'catalog:menu_delete' c.pk %}"
                              class="d-inline">
                            {% csrf_token %}
                            <button class="btn btn-sm btn-outline-danger"
                                    style="border-radius:10px;"
                                    onclick="return confirm('¿Eliminar {{ c.title|escapejs }}?')">
                                Eliminar
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}

            {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-5 text-muted">
                        No hay elementos en el menú.
                    </td>
                </tr>
            {% endfor %}

            </tbody>
        </table>

    </div>
</div>

{% endblock %}
